<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />

<style>
  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-fade-in-up {
    animation: fade-in-up 0.3s ease-out;
  }
</style>



  </head>

  <body class="bg-gray-100 dark:bg-gray-800">
    <main class="p-4 h-screen">
      <button onclick="showPopUp()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        Upload File
      </button>

      <div class="pop hidden fixed top-0 left-0 h-screen w-screen flex items-center justify-center bg-black bg-opacity-40">
        <form action="/upload" method="post" enctype="multipart/form-data" class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md relative space-y-4">
         
          <div class="flex flex-col items-center justify-center w-96">
            <label id="dropzone-label"
              for="dropzone-file"
              class="flex flex-col items-center justify-center w-full h-64 border-2 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 transition"
            >
              <div id="dropzone-content" class="flex flex-col items-center justify-center pt-5 pb-6 px-2">
                <svg class="w-8 h-8 mb-4 text-gray-500 dark:text-gray-400" aria-hidden="true" fill="none" viewBox="0 0 20 16">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5A5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2" />
                </svg>
                <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">SVG, PNG, JPG or GIF (MAX. 800x400px)</p>

            
                <p
                  id="file-name-display"
                  class="hidden text-sm text-blue-600 mt-4 truncate max-w-[90%]"
                  title=""
                ></p>
              </div>

              <input id="dropzone-file" type="file" class="hidden" name="file" />
            </label>
          </div>

 
          <div class="flex justify-center mt-3">
  <button id="upload-btn" type="submit" class="bg-gray-400 text-white font-bold py-2 px-4 rounded opacity-60 cursor-not-allowed" disabled>
    Upload
  </button>
</div>


         
          <button
            type="button"
            onclick="hidePopUp()"
            class="absolute top-2 right-2 text-white bg-gray-600 hover:bg-gray-800 p-2 rounded-full"
          >
            <i class="ri-close-line text-xl"></i>
          </button>
        </form>
      </div>

     
   <div class="files mt-5 flex flex-col gap-3">
  <% files.forEach((file) => { %>
    <div class="p-4 flex justify-between items-center rounded-md 
                bg-white dark:bg-white-800 hover:bg-blue-200 dark:border-gray-600 transition
                border border-gray-300 dark:border-gray-700 
                shadow-sm">

      <div class="max-w-[80%]">
        <h1 class="font-semibold truncate text-sm text-gray-700 dark:text-gray-1000">
          <%= file.originalName %>
        </h1>
        <p class="text-sm text-gray-700 dark:text-gray-1000">
          Uploaded: <%= new Date(file.createdAt).toLocaleString() %>
        </p>
      </div>

 
  <div class="flex items-center gap-3">
       
        <a
          href="/download?path=<%= encodeURIComponent(file.path) %>"
          download="<%= file.originalName %>"
          class="text-blue-500 hover:text-blue-700 text-xl"
          title="Download"
        >
          <i class="ri-download-cloud-fill"></i>
        </a>

        
        <form action="/delete/<%= file._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this file?')">
          <button type="submit" class="text-red-500 hover:text-red-700 text-xl" title="Delete">
            <i class="ri-delete-bin-6-fill"></i>
          </button>
        </form>
      </div>


    </div>
  <% }) %>
</div>


    </main>

   
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    <script>
  function showPopUp() {
    document.querySelector('.pop').style.display = 'flex';
  }

  function hidePopUp() {
    document.querySelector('.pop').style.display = 'none';

    
    uploadButton.disabled = true;
    uploadButton.classList.add('bg-gray-400', 'opacity-60', 'cursor-not-allowed');
    uploadButton.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'cursor-pointer');
    fileNameDisplay.classList.add('hidden');
    dropzoneLabel.classList.remove('border-blue-500', 'ring-2', 'ring-blue-300');
    dropzoneLabel.classList.add('border-gray-300');
    fileInput.value = '';
  }

  const fileInput = document.getElementById('dropzone-file');
  const uploadButton = document.getElementById('upload-btn');
  const fileNameDisplay = document.getElementById('file-name-display');
  const dropzoneLabel = document.getElementById('dropzone-label');

  fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
      const file = fileInput.files[0];
      fileNameDisplay.textContent = `ðŸ“ ${file.name}`;
      fileNameDisplay.title = file.name;
      fileNameDisplay.classList.remove('hidden');

      dropzoneLabel.classList.add('border-blue-500', 'ring-2', 'ring-blue-300');
      dropzoneLabel.classList.remove('border-gray-300');

      uploadButton.disabled = false;
      uploadButton.classList.remove('bg-gray-400', 'opacity-60', 'cursor-not-allowed');
      uploadButton.classList.add('bg-blue-600', 'hover:bg-blue-700', 'cursor-pointer');
    } else {
     
      fileNameDisplay.classList.add('hidden');
      uploadButton.disabled = true;
      uploadButton.classList.add('bg-gray-400', 'opacity-60', 'cursor-not-allowed');
      uploadButton.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'cursor-pointer');
    }
  });

 window.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    const msg = params.get('msg');

    if (msg) {
      const messageMap = {
        uploaded: 'âœ… File uploaded successfully!',
        registered: 'âœ… Registered successfully!',
        loggedin: 'âœ… Logged in successfully!',
        deleted: 'ðŸ—‘ï¸ File deleted successfully!',
      };

      const popupMessage = messageMap[msg] || msg;

      const popup = document.createElement('div');
      popup.textContent = popupMessage;
      popup.className = `
        fixed top-5 right-5 px-4 py-2 bg-green-600 text-white rounded shadow-lg z-50
        animate-fade-in-up
      `;

      document.body.appendChild(popup);

      setTimeout(() => {
        popup.remove();
      }, 3000);
    }
  });



</script>

  </body>
</html>
